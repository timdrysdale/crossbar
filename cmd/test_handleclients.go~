package main

import (
	"testing"

	"github.com/google/uuid"
)

func TestAddClientToTopic(t *testing.T) {

	var topics = make(topicDirectory)
	var name = uuid.New()
	var topic = uuid.New()
	var msg = make(chan message)

	client1 = randomClient()
	client2 = randomClient()
	client3 = randomClientForTopic(client2.topic)
	client4 = randomClientForTopic(client2.topic)

	addClientToTopic(&topics, client1)
	addClientToTopic(&topics, client2)
	addClientToTopic(&topics, client3)
	addClientToTopic(&topics, client3)

}

func randomClient() {
	return clientDetails(uuid.New(), uuid.New(), make(chan message))
}

func randomClientForTopic(topic string) {
	return clientDetails(uuid.New(), topic, make(chan message))
}

func clientExists(topics *topicDirectory, client ClientDetails) {

	topics.lock()
	existingClients := topics.directory[client.topic]
	topics.unlock()

	for _, existingClient := range existingClients {
		if client.name == existingClient.name {
			return true

		}
	}

	return false

}
